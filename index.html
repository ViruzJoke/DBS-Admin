<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DHL Admin - Shipment Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        .table-responsive {
            display: block;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        thead th {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        thead { background-color: #f3f4f6; }
        .dark-mode thead { background-color: #1f2937; }
        tbody tr:hover { background-color: #f9fafb; }
        .dark-mode tbody tr:hover { background-color: #374151; }
        
        .btn-download {
            padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 600;
            border-radius: 0.375rem; border: 1px solid transparent;
            transition: all 0.2s ease-in-out; cursor: pointer;
        }
        .btn-download-label { background-color: #dc2626; color: white; }
        .btn-download-label:hover { background-color: #b91c1c; }
        .btn-download-doc { background-color: #6b7280; color: white; }
        .btn-download-doc:hover { background-color: #4b5563; }

        .filter-group {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .dark-mode .filter-group { border-color: #374151; }
        .filter-group legend {
            padding: 0 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>

    <header class="bg-white shadow-md py-4 px-6 md:px-10 flex justify-between items-center sticky top-0 z-20">
        <div class="flex items-center">
            <span class="text-4xl font-bold text-red-600">DHL</span>
            <span class="ml-2 text-xl font-semibold text-gray-900 dark:text-gray-200">Admin Panel</span>
        </div>
        <nav class="flex items-center space-x-2 sm:space-x-4">
            <div class="relative">
                <button id="language-toggle-button" class="utility-button px-4 py-2 flex items-center gap-2">
                    <span id="current-language-display">TH</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="language-dropdown" class="language-dropdown absolute right-0 mt-2 w-28 bg-white rounded-md shadow-lg hidden z-20 dark:bg-gray-700">
                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-600" data-lang="th">ภาษาไทย</a>
                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-600" data-lang="en">English</a>
                </div>
            </div>
            <button id="theme-toggle" class="utility-button">
                <svg id="theme-icon-light" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="theme-icon-dark" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
            <button id="logout-button" class="btn-primary btn-gray" data-i18n="logout">Logout</button>
        </nav>
    </header>

    <main class="container py-8">
        <section class="card">
            <h1 class="text-2xl font-bold mb-6" data-i18n="title">Shipment Search</h1>
            <form id="filter-form">
                <fieldset class="filter-group">
                    <legend data-i18n="groupShipmentId">Shipment Identifiers</legend>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="trackingNumber" class="block text-sm font-medium" data-i18n="trackingNumber">Tracking Number</label>
                            <input type="text" id="trackingNumber" class="input-field mt-1" placeholder="*123* or 10081888*">
                        </div>
                        <div>
                            <label for="reference" class="block text-sm font-medium" data-i18n="reference">Reference</label>
                            <input type="text" id="reference" class="input-field mt-1">
                        </div>
                        <div>
                            <label for="accountNumber" class="block text-sm font-medium" data-i18n="accountNumber">Account Number</label>
                            <input type="text" id="accountNumber" class="input-field mt-1" placeholder="Shipper or Duty Account">
                        </div>
                    </div>
                </fieldset>

                <fieldset class="filter-group">
                    <legend data-i18n="groupPartyInfo">Party Information</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                         <div>
                            <label for="shipperName" class="block text-sm font-medium" data-i18n="shipperName">Shipper Name</label>
                            <input type="text" id="shipperName" class="input-field mt-1" placeholder="*Company*">
                        </div>
                        <div>
                            <label for="receiverName" class="block text-sm font-medium" data-i18n="receiverName">Receiver Name</label>
                            <input type="text" id="receiverName" class="input-field mt-1" placeholder="*Customer*">
                        </div>
                        <div>
                            <label for="shipperCountry" class="block text-sm font-medium" data-i18n="shipperCountry">Shipper Country</label>
                            <input type="text" id="shipperCountry" class="input-field mt-1" placeholder="e.g., TH, US, CN">
                        </div>
                        <div>
                            <label for="receiverCountry" class="block text-sm font-medium" data-i18n="receiverCountry">Receiver Country</label>
                            <input type="text" id="receiverCountry" class="input-field mt-1" placeholder="e.g., TH, US, CN">
                        </div>
                    </div>
                </fieldset>
                
                <fieldset class="filter-group">
                    <legend data-i18n="groupDateTime">Date & Time</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label for="dateFrom" class="block text-sm font-medium" data-i18n="dateFrom">Date From</label>
                            <input type="date" id="dateFrom" class="input-field mt-1">
                        </div>
                        <div>
                            <label for="dateTo" class="block text-sm font-medium" data-i18n="dateTo">Date To</label>
                            <input type="date" id="dateTo" class="input-field mt-1">
                        </div>
                        <div id="time-filter-group" class="hidden md:col-span-2 lg:col-span-2 grid grid-cols-2 gap-4">
                            <div>
                                <label for="timeFrom" class="block text-sm font-medium" data-i18n="timeFrom">From Time</label>
                                <input type="time" id="timeFrom" class="input-field mt-1">
                            </div>
                             <div>
                                <label for="timeTo" class="block text-sm font-medium" data-i18n="timeTo">To Time</label>
                                <input type="time" id="timeTo" class="input-field mt-1">
                            </div>
                        </div>
                    </div>
                </fieldset>

                <div class="flex gap-2 mt-6">
                    <button type="submit" id="search-button" class="btn-primary btn-yellow" data-i18n="search">Search</button>
                    <button type="button" id="clear-button" class="btn-primary btn-gray" data-i18n="clear">Clear</button>
                </div>
            </form>
        </section>

        <section id="results-section" class="mt-8">
            <div id="loading-indicator" class="text-center py-8 hidden"><p data-i18n="loading">Loading data...</p></div>
            <div id="no-results" class="text-center py-8 hidden"><p data-i18n="noResults">No results found...</p></div>
            <div id="results-table-container" class="card p-0 table-responsive hidden">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead>
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider" data-i18n="colDate">Date</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider" data-i18n="colTracking">Tracking #</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider" data-i18n="colShipper">Shipper</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider" data-i18n="colReceiver">Receiver</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider" data-i18n="colRef">Reference</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider" data-i18n="colAccount">Account</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider" data-i18n="colDownloads">Downloads</th>
                        </tr>
                    </thead>
                    <tbody id="results-tbody" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
                </table>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- [ACTIVE] Authentication Check ---
            // This block will redirect the user to login.html if they are not logged in.
            if (sessionStorage.getItem('dbs_admin_logged_in') !== 'true') {
                window.location.href = 'login.html';
                return; // Stop script execution if not logged in
            }

            const translations = { /* ... translation object remains the same ... */ };
            let currentLanguage = localStorage.getItem('language') || 'th';

            const filterForm = document.getElementById('filter-form');
            const resultsTbody = document.getElementById('results-tbody');
            const loadingIndicator = document.getElementById('loading-indicator');
            const noResultsDiv = document.getElementById('no-results');
            const resultsContainer = document.getElementById('results-table-container');
            const dateFromInput = document.getElementById('dateFrom');
            const dateToInput = document.getElementById('dateTo');
            const timeFilterGroup = document.getElementById('time-filter-group');
            const logoutButton = document.getElementById('logout-button');

            function updateContentLanguage() { /* ... function remains the same ... */ }
            function setupTheme() { /* ... function remains the same ... */ }
            function setupLanguageSwitch() { /* ... function remains the same ... */ }
            function downloadPdfFromBase64(base64String, fileName) { /* ... function remains the same ... */ }
            function toggleTimeFilter() { /* ... function remains the same ... */ }

            dateFromInput.addEventListener('change', toggleTimeFilter);
            dateToInput.addEventListener('change', toggleTimeFilter);
            filterForm.addEventListener('submit', (e) => { e.preventDefault(); fetchLogs(); });
            document.getElementById('clear-button').addEventListener('click', () => { /* ... */ });
            
            logoutButton.addEventListener('click', () => {
                sessionStorage.removeItem('dbs_admin_logged_in');
                window.location.href = 'login.html';
            });

            async function fetchLogs() { /* ... function remains the same ... */ }
            function renderTable(logs) { /* ... function remains the same ... */ }
            
            setupTheme();
            setupLanguageSwitch();
            updateContentLanguage();
        });
    </script>
</body>
</html>
